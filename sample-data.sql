-- sample-data.sql - Тестовые данные для системы управления заявками НК
-- 20 реалистичных заявок с разными статусами

-- Очистка существующих данных (опционально)
-- DELETE FROM requests_v2;
-- DELETE FROM history_v2;
-- DELETE FROM comments;

-- Вставка тестовых заявок
INSERT INTO requests_v2 (
    date, order_number, drawing, certificate, material, quantity, operation,
    station_id, control_type_id, executor_id, organization_id, status_id,
    tech_requirements, surface_preparation, english_required, notes, priority,
    deadline, control_date, protocol_number, created_by, updated_by
) VALUES 
-- 1. Новая заявка - УЗК для Руппур
(
    '2024-12-20', '2022/048', 'НЗ.022.048.005.01 - Корпус', '7785',
    '08х18н10т (co<0,2%) пл.494626', 'ф40-800мм-1шт, ф40-500мм-1шт', 10,
    1, 1, 1, 1, 2,
    'п.6. co<0,2% ТБ1 допускается по с+', 'Требуется зачистка', 1, 
    'Срочный заказ для АЭС Руппур', 1,
    '2024-12-25', NULL, NULL, 'Матросова', 'Матросова'
),

-- 2. В работе - ЦД для Аккую
(
    '2024-12-18', '2022/048', 'НЗ.022.048.065 - Устройство дроссельное', '2802-23',
    '08х18н10т пл.497292', 'ф120-570мм-1шт', 15,
    2, 2, 2, 2, 3,
    'Вид т/о- аустенизация', 'Поверхность подготовлена', 1,
    'Контроль после термообработки', 2,
    '2024-12-28', NULL, NULL, 'Петров', 'Петров'
),

-- 3. На контроле - РК для Нововоронежской
(
    '2024-12-15', '2023/015', 'ВН.023.015.102 - Патрубок Ду300', '3456-24',
    '09Г2С пл.К89542', 'ф325х16-1200мм-2шт', 20,
    3, 3, 1, 1, 4,
    'Контроль сварных швов 100%', 'Дробеструйная обработка выполнена', 0,
    'Контроль кольцевых швов', 2,
    '2024-12-22', '2024-12-19', NULL, 'Матросова', 'Матросова'
),

-- 4. Требует корректировки - ТО для Руппур
(
    '2024-12-10', '2022/048', 'НЗ.022.048.025.02 - Фланец', '10896-22',
    '08х18н10т (co<0,2%) пл.494626', 'ф250-120мм-4шт', 25,
    1, 4, 2, 3, 5,
    'ТБ1 допускается по с+. Вид т/о аустенизация', NULL, 1,
    'Обнаружены отклонения в режиме термообработки', 1,
    '2024-12-20', '2024-12-16', 'ТО-245-2024', 'Петров', 'Петров'
),

-- 5. Завершена - НК для Аккую
(
    '2024-12-05', '2023/052', 'АК.023.052.008 - Крышка', '5678-24',
    '12Х18Н10Т пл.Б45789', 'ф400х50-1шт', 30,
    2, 5, 3, 2, 7,
    'Комплексный НК: ВИК+ПВК+УЗК', 'Обработка по Ra 3.2', 1,
    'Дефектов не обнаружено', 2,
    '2024-12-15', '2024-12-12', 'НК-567-2024', 'Иванов', 'Иванов'
),

-- 6. Приостановлена - УЗК для Белорусской АЭС
(
    '2024-12-12', '2024/003', 'БН.024.003.045 - Обечайка', '8901-24',
    '10ГН2МФА пл.С12345', 'ф2000х80-3000мм-1шт', 35,
    4, 1, 1, 1, 6,
    'УЗК основного металла и сварных соединений', 'Требуется', 0,
    'Ожидание поставки оборудования для контроля', 3,
    '2024-12-30', NULL, NULL, 'Матросова', 'Матросова'
),

-- 7. Новая - ВИК для Куданкулам
(
    '2024-12-19', '2024/025', 'КК.024.025.110 - Переходник', '2345-24',
    '08х18н10т пл.D67890', 'ф150/ф100-250мм-6шт', 5,
    5, 6, 2, 1, 2,
    'Визуальный контроль геометрии и качества поверхности', NULL, 1,
    'Партия для индийской АЭС', 2,
    '2024-12-26', NULL, NULL, 'Петров', 'Петров'
),

-- 8. В работе - МК для Руппур
(
    '2024-12-17', '2022/048', 'НЗ.022.048.089 - Вал', '6789-24',
    '40ХН2МА пл.Е23456', 'ф80-1500мм-2шт', 40,
    1, 7, 3, 3, 3,
    'Магнитопорошковый контроль после мехобработки', 'Шлифовка Ra 1.6', 0,
    NULL, 2,
    '2024-12-27', NULL, NULL, 'Иванов', 'Иванов'
),

-- 9. Завершена - ПВК для Аккую
(
    '2024-12-01', '2023/052', 'АК.023.052.015 - Штуцер', '3456-24',
    '12Х18Н10Т пл.F34567', 'ф50-200мм-10шт', 45,
    2, 8, 1, 2, 7,
    'Капиллярный контроль сварных швов', 'Травление выполнено', 1,
    'Индикаторные следы не обнаружены', 3,
    '2024-12-10', '2024-12-08', 'ПВК-123-2024', 'Матросова', 'Матросова'
),

-- 10. На контроле - УЗК для Нововоронежской
(
    '2024-12-16', '2023/015', 'ВН.023.015.205 - Днище', '7890-24',
    '09Г2С пл.G45678', 'ф2400х60-1шт', 50,
    3, 1, 2, 1, 4,
    'УЗК днища толщиной 60мм', 'Дробеструйная обработка', 0,
    'Контроль зон термического влияния', 1,
    '2024-12-23', '2024-12-20', NULL, 'Петров', 'Петров'
),

-- 11. Новая - ЦД для Белорусской АЭС
(
    '2024-12-20', '2024/003', 'БН.024.003.078 - Коллектор', '8902-24',
    '15Х2МФА пл.H56789', 'ф500х40-2000мм-1шт', 55,
    4, 2, 3, 3, 2,
    'Цветная дефектоскопия сварных соединений', NULL, 0,
    'Особое внимание на угловые швы', 2,
    '2024-12-30', NULL, NULL, 'Иванов', 'Иванов'
),

-- 12. Требует корректировки - РК для Куданкулам
(
    '2024-12-08', '2024/025', 'КК.024.025.089 - Тройник', '9012-24',
    '08х18н10т пл.J67890', 'ф200/ф150-1шт', 60,
    5, 3, 1, 2, 5,
    'Радиографический контроль тройниковых соединений', 'Подготовлена', 1,
    'Требуется повторная съемка - недостаточная плотность', 1,
    '2024-12-18', '2024-12-14', 'РК-456-2024', 'Матросова', 'Матросова'
),

-- 13. Завершена - ТО для Руппур
(
    '2024-11-25', '2022/048', 'НЗ.022.048.112 - Кольцо уплотнительное', '3457-24',
    '12Х18Н10Т пл.K78901', 'ф300/ф250х30-8шт', 65,
    1, 4, 2, 1, 7,
    'Аустенизация при 1050°С', 'Не требуется', 0,
    'Режим ТО выдержан, твердость в норме', 2,
    '2024-12-05', '2024-12-02', 'ТО-789-2024', 'Петров', 'Петров'
),

-- 14. В работе - НК для Аккую
(
    '2024-12-18', '2023/052', 'АК.023.052.156 - Решетка', '4568-24',
    '08х13 пл.L89012', '1200х800х20мм-2шт', 70,
    2, 5, 3, 3, 3,
    'Комплексный контроль: ВИК+УЗК+ТВ', 'Фрезерование выполнено', 1,
    'Контроль перфорированной зоны', 2,
    '2024-12-28', NULL, NULL, 'Иванов', 'Иванов'
),

-- 15. Отменена - ВИК для Нововоронежской
(
    '2024-12-10', '2023/015', 'ВН.023.015.089 - Опора', '5679-24',
    'Ст3сп5 пл.M90123', '500х500х50мм-4шт', 75,
    3, 6, 1, 1, 8,
    'Визуальный контроль сварных швов', NULL, 0,
    'Заказ отменен заказчиком', 3,
    '2024-12-20', NULL, NULL, 'Матросова', 'Матросова'
),

-- 16. На контроле - МК для Белорусской АЭС
(
    '2024-12-17', '2024/003', 'БН.024.003.234 - Шток', '6780-24',
    '38ХН3МФА пл.N01234', 'ф120-3000мм-1шт', 80,
    4, 7, 2, 2, 4,
    'МК после окончательной мехобработки', 'Шлифование Ra 0.8', 0,
    'Контроль галтелей и резьбовых участков', 1,
    '2024-12-24', '2024-12-21', NULL, 'Петров', 'Петров'
),

-- 17. Завершена - ПВК для Куданкулам
(
    '2024-12-03', '2024/025', 'КК.024.025.345 - Сопло', '7891-24',
    '12Х18Н10Т пл.P12345', 'ф25-150мм-20шт', 85,
    5, 8, 3, 1, 7,
    'Капиллярный контроль после сварки', 'Травление и пассивация', 1,
    'Качество соответствует требованиям', 2,
    '2024-12-13', '2024-12-10', 'ПВК-890-2024', 'Иванов', 'Иванов'
),

-- 18. Новая - УЗК для Руппур (срочная)
(
    '2024-12-21', '2022/048', 'НЗ.022.048.456 - Крышка люка', '8903-24',
    '09Г2С пл.Q23456', 'ф800х40-1шт', 90,
    1, 1, 1, 3, 2,
    'УЗК основного металла и приварных элементов', NULL, 1,
    'СРОЧНО! Отгрузка 25.12', 1,
    '2024-12-24', NULL, NULL, 'Матросова', 'Матросова'
),

-- 19. В работе - ЦД для Аккую
(
    '2024-12-19', '2023/052', 'АК.023.052.789 - Змеевик', '9013-24',
    '10Х2М пл.R34567', 'ф32х3-12000мм-1шт', 95,
    2, 2, 2, 2, 3,
    'Цветная дефектоскопия гибов', 'Обезжиривание выполнено', 1,
    'Особый контроль зон гибки R=100мм', 2,
    '2024-12-29', NULL, NULL, 'Петров', 'Петров'
),

-- 20. Завершена с архивацией - РК для Нововоронежской
(
    '2024-11-15', '2023/015', 'ВН.023.015.001 - Корпус реактора', '1234-24',
    '15Х2НМФА пл.А12345', 'ф4500х300-6000мм-1шт', 100,
    3, 3, 1, 1, 9,
    'Радиографический контроль кольцевых швов №1-4', 'Выполнена', 0,
    'Архивный экземпляр. Все протоколы переданы заказчику', 3,
    '2024-11-25', '2024-11-22', 'РК-001-2024', 'Матросова', 'Матросова'
);

-- Добавление комментариев к некоторым заявкам
INSERT INTO comments (request_id, comment_text, created_by, is_internal) VALUES
(4, 'Заказчик требует корректировку протокола ТО - указать фактическую температуру', 'Петров', 0),
(4, 'Связаться с термистом для уточнения режимов', 'Матросова', 1),
(10, 'Обнаружены незначительные индикации в ЗТВ, требуется дополнительная проверка', 'Петров', 0),
(12, 'Повторная съемка назначена на 22.12', 'Матросова', 0),
(18, 'Внимание! Срочный заказ! Приоритет выполнения', 'Матросова', 1);

-- Добавление истории для некоторых заявок
INSERT INTO history_v2 (request_id, action_type, field_name, old_value, new_value, user, comment) VALUES
(4, 'STATUS_CHANGE', 'status_id', '4', '5', 'Петров', 'Требуется корректировка протокола'),
(5, 'STATUS_CHANGE', 'status_id', '4', '7', 'Иванов', 'Контроль завершен успешно'),
(10, 'UPDATE', 'control_date', NULL, '2024-12-20', 'Петров', 'Начат контроль'),
(12, 'STATUS_CHANGE', 'status_id', '4', '5', 'Матросова', 'Недостаточное качество снимков'),
(15, 'STATUS_CHANGE', 'status_id', '2', '8', 'Матросова', 'Заказ отменен заказчиком');

-- Просмотр результата
SELECT 
    r.id,
    r.request_number,
    r.order_number,
    r.drawing,
    s.name as status,
    ct.name as control_type,
    st.name as station,
    e.full_name as executor
FROM requests_v2 r
JOIN statuses s ON r.status_id = s.id
JOIN control_types ct ON r.control_type_id = ct.id
JOIN stations st ON r.station_id = st.id
JOIN executors e ON r.executor_id = e.id
ORDER BY r.id;